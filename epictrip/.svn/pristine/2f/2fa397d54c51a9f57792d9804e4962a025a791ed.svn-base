<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd" >	
<mapper namespace="com.web.epictrip.dao.Company_dao">
	<!-- 동행 리스트 출력-->
	<!-- 제목검색, 최신순, 조회순 정렬 동적 쿼리-->
    <select id="cpList" resultType="company">
        SELECT * FROM COMPANY c, USERINFO u 
        WHERE c.USERID = u.USERID 
        AND CPTITLE LIKE '%' || #{cptitle} || '%'
        <choose>
			<when test="orderType == 'hits'">
			    ORDER BY <!--  &lt; 이스케이프 -->
			    CASE WHEN c.enddate &lt; SYSDATE THEN 1 ELSE 0 END,
			    c.hits DESC,
			    c.creatdate DESC
			</when>
            <otherwise>
                ORDER BY 
                CASE WHEN c.enddate &lt; SYSDATE THEN 1 ELSE 0 END,
                c.creatdate DESC
            </otherwise>
        </choose>
    </select>
    <insert id="insertCompany" parameterType="company">
        INSERT INTO COMPANY values(company_sq.nextval,#{userid},#{cpimage},
        #{cptitle},#{cpcontent},#{cploc},#{cpnum},0,0,#{startdate},#{enddate},sysdate)
    </insert>
    <!-- 동행 상세 출력 -->
    <select id="getCompanyDetails" resultType="company" parameterType="int">
	    SELECT *
	    FROM COMPANY c, USERINFO u 
	    WHERE c.USERID = u.USERID 
	    AND CPKEY = #{cpkey}
	</select>
	
    <!-- 동행 상세 수정 -->
	<update id="updateCompany" parameterType="company">
	    UPDATE COMPANY 
	    SET 
	        CPLOC = #{cploc},
	        CPNUM = #{cpnum},
	        STARTDATE = #{startdate},
	        ENDDATE = #{enddate},
	        CPIMAGE = #{cpimage},
	        CPTITLE = #{cptitle},
	        CPCONTENT = #{cpcontent}
	    WHERE CPKEY = #{cpkey}
	    AND USERID = #{userid}
	</update>
	
    <!-- 동행 상세 삭제 -->
	<delete id="deleteCompany" parameterType="map">
	    DELETE FROM COMPANY 
	    WHERE CPKEY = #{cpkey}
	    AND USERID = #{userid}
	</delete>
	<!-- 조회수 증가 -->
    <update id="increaseHits">
	    UPDATE COMPANY
	    SET hits = hits + 1
	    WHERE cpkey = #{cpkey}
	</update>
    
    
</mapper>



	