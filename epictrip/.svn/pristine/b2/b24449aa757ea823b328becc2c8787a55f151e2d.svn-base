package com.web.epictrip.service;

import java.util.Collections;
import java.util.HashSet;
import java.util.Set;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.web.epictrip.repository.ChatMessageRepository;
import com.web.epictrip.vo.ChatMessage;
import com.web.epictrip.vo.Userinfo;

import jakarta.transaction.Transactional;

@Service
public class ChatService {

    @Autowired
    private ChatMessageRepository chatMessageRepository;

    // 메시지 저장
    public ChatMessage saveMessage(ChatMessage chatMessage) {
        return chatMessageRepository.save(chatMessage);
    }

    @Transactional
    public ChatMessage getMessageWithUser(Long messageId) {
        ChatMessage chatMessage = chatMessageRepository.findById(messageId).orElse(null);
        Userinfo sender = chatMessage.getSender();
        String senderName = sender.getName();  // 예를 들어, sender의 이름에 액세스
        return chatMessage;
    }

    // 현재 채팅방에 접속 중인 사용자들의 목록
    private Set<Userinfo> currentUsers = Collections.synchronizedSet(new HashSet<>());

    // 사용자 추가
    public void addUser(Userinfo user) {
        currentUsers.add(user);
    }

    // 사용자 제거
    public void removeUser(Userinfo user) {
        currentUsers.remove(user);
    }

    // 현재 사용자 목록 반환
    public Set<Userinfo> getCurrentUsers() {
        return currentUsers;
    }
}
