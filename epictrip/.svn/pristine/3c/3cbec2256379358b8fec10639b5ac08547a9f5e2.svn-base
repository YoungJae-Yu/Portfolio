package com.web.epictrip.service;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.web.epictrip.repository.ChatMessageRepository;
import com.web.epictrip.vo.ChatMessage;
import com.web.epictrip.vo.Userinfo;

import jakarta.transaction.Transactional;

@Service
public class ChatService {
    @Autowired
    private ChatMessageRepository chatMessageRepository;

    public ChatMessage saveMessage(ChatMessage chatMessage) {
        return chatMessageRepository.save(chatMessage);
    }
    @Transactional
    public ChatMessage getMessageWithUser(Long messageId) {
        ChatMessage chatMessage = chatMessageRepository.findById(messageId).orElse(null);
        
        // 이 트랜잭션 범위 내에서 Userinfo 정보에 액세스하면 LazyInitializationException이 발생하지 않습니다.
        Userinfo sender = chatMessage.getSender();
        String senderName = sender.getName();  // 예를 들어, sender의 이름에 액세스
        
        return chatMessage;
    }
}

